// Prisma Schema for Airdrop Intelligence Pro
// 使用 SQLite 数据库 (开发环境)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 用户模型
model User {
  id              String    @id @default(uuid())
  email           String    @unique
  password        String?   // 密码登录可选
  name            String?
  avatar          String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // 关联订阅
  subscription    Subscription?
  
  // 关联用户偏好设置
  preferences     UserPreference?
  
  // 关联激活码（如果用户是管理员）
  activationCodes ActivationCode[]
}

// 订阅模型
model Subscription {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  plan            String    @default("free") // free, basic, pro, enterprise
  status          String    @default("active") // active, inactive, expired
  startDate       DateTime  @default(now())
  expireDate      DateTime?
  
  // 激活码信息
  activationCodeId String?
  activationCode   ActivationCode? @relation(fields: [activationCodeId], references: [id])
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// 激活码模型
model ActivationCode {
  id              String    @id @default(uuid())
  code            String    @unique
  plan            String    // free, basic, pro, enterprise
  durationDays    Int       // 有效天数
  maxUsers        Int       @default(1) // 最大使用用户数
  usedCount       Int       @default(0) // 已使用次数
  isActive        Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  expiresAt       DateTime?
  
  // 关联创建者（管理员）
  createdById    String?
  createdBy       User?     @relation(fields: [createdById], references: [id])
  
  // 关联订阅
  subscriptions   Subscription[]
}

// 空投项目模型
model Airdrop {
  id              String    @id @default(uuid())
  name            String
  slug            String    @unique
  description     String?
  logo            String?
  website         String?
  twitter         String?
  discord         String?
  
  // 空投详情
  category        String    // DeFi, GameFi, NFT, etc.
  status          String    @default("upcoming") // upcoming, active, ended
  startDate       DateTime?
  endDate         DateTime?
  
  // 任务详情
  tasks           String?   // JSON格式的任务列表
  
  // 预估价值
  estimatedValue  String?
  
  // 难度
  difficulty      String    @default("medium") // easy, medium, hard
  
  // 标签
  tags            String?   // 逗号分隔的标签
  
  // 数据来源
  source          String?   // twitter, discord, website
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// 用户偏好设置模型
model UserPreference {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // 通知设置
  emailNotifications Boolean @default(true)
  browserNotifications Boolean @default(false)
  
  // 空投筛选偏好
  preferredCategories String? // 逗号分隔
  difficultyFilter    String?  // easy, medium, hard, all
  
  // 监控设置
  monitoredTwitter  String?   // 监控的Twitter账号
  monitoredDiscord  String?   // 监控的Discord频道
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}
